language: node_js
node_js:
  - '14.17.0'
before_cache:
  # awss3-deploy
  - pip install --user awscli

before_deploy:
  - export BUCKET=s3-deployed-app LOCAL_DIR=build
  - npm run build
  - export PATH=./node_modules/.bin:$PATH

branches:
  only:
    - dev
    - master

deploy:
  - provider: script
    skip_cleanup: true
    script:
      - export UPLOAD_DIR=development
      - awss3-deploy
    on:
      branch: dev

  - provider: script
    skip_cleanup: true
    script:
      - export UPLOAD_DIR=staging
      - awss3-deploy
    on:
      branch: master
